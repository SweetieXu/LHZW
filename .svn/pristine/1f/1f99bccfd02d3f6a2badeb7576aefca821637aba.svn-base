@{
    ViewBag.Title = "TerminalFlagsViewer";
}
@using Asiatek.TMS.TerminalOperation
@using Asiatek.Resource

<style>
    td > div {
        margin: 0 !important;
    }

    #resultTable tr > td:nth-child(1) {
        text-align: center;
        width: 30%;
    }

    #resultTable tr > td:nth-child(2) {
        width: 70%;
    }
</style>

<div class="panel panel-default" style="margin:10px 0">
    <div class="panel-heading">@UIText.TerminalSetting_Query</div>
    <div class="panel-body">
        <table class="table">
            <tr>
                <td><div class="checkbox"><label><input type="checkbox" name="paramType" value="@((uint)TerminalParaID.终端心跳发送间隔)" />@UIText.TerminalSetting_HeartbeatInterval</label></div></td>
                <td><div class="checkbox"><label><input type="checkbox" name="paramType" value="@((uint)TerminalParaID.位置汇报策略)" />@UIText.TerminalSetting_LocationReportPolicy</label></div></td>
                <td><div class="checkbox"><label><input type="checkbox" name="paramType" value="@((uint)TerminalParaID.位置汇报方案)" />@UIText.TerminalSetting_LocationReportTrigger</label></div></td>
                <td><div class="checkbox"><label><input type="checkbox" name="paramType" value="@((uint)TerminalParaID.驾驶员未登录汇报时间间隔)" />@UIText.TerminalSetting_StateRepotrInterval_NotLoggedIn</label></div></td>
            </tr>
            <tr>
                <td><div class="checkbox"><label><input type="checkbox" name="paramType" value="@((uint)TerminalParaID.休眠时汇报时间间隔)" />@UIText.TerminalSetting_StateRepotrInterval_Sleep</label></div></td>
                <td><div class="checkbox"><label><input type="checkbox" name="paramType" value="@((uint)TerminalParaID.紧急报警时汇报时间间隔)" />@UIText.TerminalSetting_StateRepotrInterval_Urgent</label></div></td>
                <td><div class="checkbox"><label><input type="checkbox" name="paramType" value="@((uint)TerminalParaID.缺省时间汇报间隔)" />@UIText.TerminalSetting_StateRepotrInterval_General</label></div></td>
                <td><div class="checkbox"><label><input type="checkbox" name="paramType" value="@((uint)TerminalParaID.最高速度)" />@UIText.TerminalSetting_MaximumSpeed</label></div></td>
            </tr>
            <tr>
                <td><div class="checkbox"><label><input type="checkbox" name="paramType" value="@((uint)TerminalParaID.超速持续时间)" />@UIText.TerminalSetting_OverspeedCheckTime</label></div></td>
                <td><div class="checkbox"><label><input type="checkbox" name="paramType" value="@((uint)TerminalParaID.超速报警预警差值)" />@UIText.TerminalSetting_DifferenceOfOverspeedValues</label></div></td>
                <td><div class="checkbox"><label><input type="checkbox" name="paramType" value="@((uint)TerminalParaID.连续驾驶时间门限)" />@UIText.TerminalSetting_MaximumDrivingTime</label></div></td>
                <td><div class="checkbox"><label><input type="checkbox" name="paramType" value="@((uint)TerminalParaID.当天累计驾驶时间门限)" />@UIText.TerminalSetting_MaximumDrivingTimeToday</label></div></td>
            </tr>
            <tr>
                <td><div class="checkbox"><label><input type="checkbox" name="paramType" value="@((uint)TerminalParaID.疲劳驾驶预警差值)" />@UIText.TerminalSetting_DifferenceOfFatigueDrivingTime</label></div></td>
                <td><div class="checkbox"><label><input type="checkbox" name="paramType" value="@((uint)TerminalParaID.最小休息时间)" />@UIText.TerminalSetting_MinimumBreakTime</label></div></td>
                <td><div class="checkbox"><label><input type="checkbox" name="paramType" value="@((uint)TerminalParaID.最长停车时间)" />@UIText.TerminalSetting_MaximumStoppingTime</label></div></td>
                <td><div class="checkbox"><label><input type="checkbox" name="paramType" value="@((uint)TerminalParaID.车辆里程表读数)" />@UIText.TerminalSetting_TotalODO</label></div></td>
            </tr>
            <tr>
                <td><div class="checkbox"><label><input type="checkbox" name="paramType" value="@((uint)TerminalParaID.监听电话号码)" />@UIText.TerminalSetting_TelphoneNO</label></div></td>
                <td></td>
                <td></td>
                <td></td>
            </tr>
            <tr><td></td><td></td><td></td><td><button id="querySettings" class="btn btn-primary pull-right" disabled onclick="onQuerySettings();">@UIText.TerminalSetting_QuerySetting</button></td></tr>

        </table>
        <div>
            <table class="table " id="resultTable">
                <tbody>

                    <tr class="hidden" id="HeartbeatInterval">
                        <td>@UIText.TerminalSetting_HeartbeatInterval</td>
                        <td><input class="form-control" type="text" disabled /></td>
                    </tr>

                    <tr class="hidden" id="LocationReportPolicy">
                        <td>@UIText.TerminalSetting_LocationReportPolicy</td>
                        <td><input class="form-control" type="text" disabled /></td>
                    </tr>

                    <tr class="hidden" id="LocationReportTrigger">
                        <td>@UIText.TerminalSetting_LocationReportTrigger</td>
                        <td><input class="form-control" type="text" disabled /></td>
                    </tr>

                    <tr class="hidden" id="StateRepotrInterval_NotLoggedIn">
                        <td>@UIText.TerminalSetting_StateRepotrInterval_NotLoggedIn</td>
                        <td><input class="form-control" type="text" disabled /></td>
                    </tr>

                    <tr class="hidden" id="StateRepotrInterval_Sleep">
                        <td>@UIText.TerminalSetting_StateRepotrInterval_Sleep</td>
                        <td><input class="form-control" type="text" disabled /></td>
                    </tr>

                    <tr class="hidden" id="StateRepotrInterval_Urgent">
                        <td>@UIText.TerminalSetting_StateRepotrInterval_Urgent</td>
                        <td><input class="form-control" type="text" disabled /></td>
                    </tr>

                    <tr class="hidden" id="StateRepotrInterval_General">
                        <td>@UIText.TerminalSetting_StateRepotrInterval_General</td>
                        <td><input class="form-control" type="text" disabled /></td>
                    </tr>

                    <tr class="hidden" id="MaximumSpeed">
                        <td>@UIText.TerminalSetting_MaximumSpeed</td>
                        <td><input class="form-control" type="text" disabled /></td>
                    </tr>

                    <tr class="hidden" id="OverspeedCheckTime">
                        <td>@UIText.TerminalSetting_OverspeedCheckTime</td>
                        <td><input class="form-control" type="text" disabled /></td>
                    </tr>

                    <tr class="hidden" id="DifferenceOfOverspeedValues">
                        <td>@UIText.TerminalSetting_DifferenceOfOverspeedValues</td>
                        <td><input class="form-control" type="text" disabled /></td>
                    </tr>

                    <tr class="hidden" id="MaximumDrivingTime">
                        <td>@UIText.TerminalSetting_MaximumDrivingTime</td>
                        <td><input class="form-control" type="text" disabled /></td>
                    </tr>

                    <tr class="hidden" id="MaximumDrivingTimeToday">
                        <td>@UIText.TerminalSetting_MaximumDrivingTimeToday</td>
                        <td><input class="form-control" type="text" disabled /></td>
                    </tr>

                    <tr class="hidden" id="DifferenceOfFatigueDrivingTime">
                        <td>@UIText.TerminalSetting_DifferenceOfFatigueDrivingTime</td>
                        <td><input class="form-control" type="text" disabled /></td>
                    </tr>

                    <tr class="hidden" id="MinimumBreakTime">
                        <td>@UIText.TerminalSetting_MinimumBreakTime</td>
                        <td><input class="form-control" type="text" disabled /></td>
                    </tr>

                    <tr class="hidden" id="MaximumStoppingTime">
                        <td>@UIText.TerminalSetting_MaximumStoppingTime</td>
                        <td><input class="form-control" type="text"disabled /></td>
                    </tr>

                    <tr class="hidden" id="TotalODO">
                        <td>@UIText.TerminalSetting_TotalODO</td>
                        <td><input class="form-control" type="text" disabled /></td>
                    </tr>

                    <tr class="hidden" id="TelphoneNO">
                        <td>@UIText.TerminalSetting_TelphoneNO</td>
                        <td><input class="form-control" type="tel" disabled /></td>
                    </tr>

                </tbody>
            </table>
        </div>
    </div>
</div>

<script>
    $(function () {
        // 注册车辆选中回调函数
        VehicleSelectedEventHandlers.push(_OnVehicleSelected);
        VehicleUnselectedEventHandlers.push(_OnVehicleUnselected);
    });

    function onQuerySettings() {
        //初始化
        $('#resultTable tr').attr('class', 'hidden');
        $('#resultTable tr input').val('');

        var values = new Array();
        var elements = $('input[name=paramType]:checked');
        elements.each(function (index, element) {
            values.push($(element).val());
        });

        vehiclesSelected = new Array();
        for (v in vehiclesTree_GetSelectedNode()) {
            vehiclesSelected.push(v + '#' + vehicles[v]);
        }

        $.ajax({
            type: 'POST',
            url: '@Url.Action("QueryTerminalFlags")',
            cache: false,
            data: {
                Vehicle: vehiclesSelected,
                Settings: values
            },
            traditional: true,
            success: function (data) {
                var result = JSON.parse(data);
                for (key in result) {
                    if (result[key] == null)
                        continue;
                    $('#' + key).attr('class', '');
                    $('#' + key + ' input').val(result[key]);
                }
            }
        });
    }

    function _OnVehicleSelected(vehicles) {
        if ($.isEmptyObject(vehiclesTree_GetSelectedNode())) {
            // 当未选中任何车辆时禁用 读取设置 按钮
            $('#querySettings').attr('disabled', true);
        }
        else {
            // 启用 读取设置 按钮
            $('#querySettings').removeAttr('disabled');
        }
    };

    function _OnVehicleUnselected(vehicles) {
    }
</script>
